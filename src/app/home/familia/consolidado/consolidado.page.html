<ion-header>
  <ion-toolbar>
    <ion-title>Consolidado Familiar</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card-header color='primary'>
    <ion-toolbar color='primary' class="ion-text-center">
      <ion-title>CONSOLIDADO FAMILIAR</ion-title>
      <ion-fab-button type='button' slot='end' size='small' (click)='download()' color='danger'>
        <ion-icon name='cloud-download'>
        </ion-icon>
      </ion-fab-button>

    </ion-toolbar>
    <ion-toolbar color='primary' class="ion-text-end" (click)='volverFamilias()'>
      <ion-label>
        <ion-icon name="arrow-back-outline"></ion-icon>
        Volver a Familias
      </ion-label>
    </ion-toolbar>
    <ion-row color='primary'>
      <ion-col size=8>
        FAMILIA DE: {{ familia?.ApellidoPaterno}} {{ familia?.ApellidoMaterno}} {{ familia?.Nombres}}
      </ion-col>
      <ion-col size=4>
        DNI TITULAR: {{ familia?.DNI }}
      </ion-col>
    </ion-row>
  </ion-card-header>

  <ion-card-header color='primary'>
    <ion-toolbar color='primary' (click)='showMiembros=!showMiembros'>
      <ion-row>
        <ion-col size=8>
          <ion-label>CALIFICACIÓN DE LOS MIEMBROS DE LA FAMILIA</ion-label>
        </ion-col>
        <ion-col class="ion-text-end">
          <ion-chip outline color='light'>
            <ion-label>(click)</ion-label>
            <ion-icon name='chevron-down-outline' *ngIf='!showMiembros'></ion-icon>
            <ion-icon name='chevron-up-outline' *ngIf='showMiembros'></ion-icon>
          </ion-chip>
        </ion-col>
      </ion-row>
    </ion-toolbar>
  </ion-card-header>

  <div *ngIf='showMiembros'>

    <ngx-datatable class="material" [rows]="personas" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50"
      [rowHeight]="50" [scrollbarV]="true" [scrollbarH]="true" #myTable>

      <ngx-datatable-row-detail [rowHeight]="240">
        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
          <strong>CALIFICACIÓN</strong>
          <ion-row>
            <div *ngFor='let i of row.Items, let index=index'>
              <ion-col *ngIf='i.Estado && i.Puntos > 0'>
                <span>
                  <ion-chip *ngIf='i.Medida.toLowerCase() !== "% spo2"'>
                    <ion-label>{{ i.Item }}</ion-label>
                    <ion-badge color='primary'>{{ i.Puntos }} Pts</ion-badge>
                  </ion-chip>
                  <ion-chip *ngIf='i.Medida.toLowerCase() === "% spo2"'>
                    <ion-label>{{ i.Item }}( OJO No cuenta en la suma si su valor es mayor o igual a 95)</ion-label>
                    <ion-label> <strong> Valor: {{ i.Valor }} {{ i.Medida}} </strong></ion-label>
                    <ion-badge color='primary'>{{ i.Puntos }} Pts</ion-badge>
                  </ion-chip>
                </span>
              </ion-col>

              <!-- <ng-template #bloqueelse>
                <ion-col *ngIf='i.Estado && i.Puntos > 0'>
                  <span>
                    <ion-chip>
                      <ion-label>{{ i.Item }}</ion-label>
                      <ion-badge color='primary'>{{ i.Puntos }} Pts</ion-badge>
                    </ion-chip>
                  </span>
                </ion-col>
              </ng-template> -->
            </div>
          </ion-row>
        </ng-template>
      </ngx-datatable-row-detail>

      <ngx-datatable-column name='DNI' prop="DNI" [frozenLeft]="true" [width]="100">
        <ng-template let-row='row' ngx-datatable-cell-template>
          <ion-note color='primary' (click)='antecedentes(row)'>
            {{ row.DNI }}
          </ion-note>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name='VÍNCULO FAMILIAR' prop="VinculoFamiliar">
      </ngx-datatable-column>
      <ngx-datatable-column name='AP. PATERNO' prop="ApellidoPaterno">
      </ngx-datatable-column>
      <ngx-datatable-column name='AP. MATERNO' prop="ApellidoMaterno">
      </ngx-datatable-column>
      <ngx-datatable-column name='NOMBRES' prop="Nombres">
      </ngx-datatable-column>
      <ngx-datatable-column name='EDAD' prop="Edad" [width]="60">
        <ng-template let-row='row' ngx-datatable-cell-template>
          <div class="ion-text-center">
            {{ row.Edad }}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name='PUNTAJE PARCIAL' prop="PuntajeParcial">
        <ng-template let-row='row' ngx-datatable-cell-template>
          <div class="ion-text-center">
            <ion-note color='primary' (click)='antecedentes(row)'>
              <strong> {{ row.PuntajeParcial ? row.PuntajeParcial : 0 }} PUNTOS </strong>
            </ion-note>
          </div>
        </ng-template>
      </ngx-datatable-column>

    </ngx-datatable>

    <ion-card-header color='success'>
      <ion-toolbar color='success'>

        <ion-row>
          <ion-col>
            <ion-label>SUBTOTAL : </ion-label>
          </ion-col>
          <ion-col class="ion-text-end">
            <ion-label>{{ sumaMiembros}} PUNTOS</ion-label>
          </ion-col>
        </ion-row>

      </ion-toolbar>
    </ion-card-header>

  </div>

  <ion-card-header color='primary'>
    <ion-toolbar color='primary' (click)='showFactores=!showFactores'>
      <ion-row>
        <ion-col size=8>
          <ion-label>FACTORES ANEXOS</ion-label>
        </ion-col>

        <ion-col class="ion-text-end">
          <ion-chip outline color='light'>
            <ion-label>(click)</ion-label>
            <ion-icon name='chevron-down-outline' *ngIf='!showFactores'></ion-icon>
            <ion-icon name='chevron-up-outline' *ngIf='showFactores'></ion-icon>
          </ion-chip>
        </ion-col>
      </ion-row>
    </ion-toolbar>
  </ion-card-header>

  <div *ngIf='showFactores'>
    <ion-row>
      <ion-col>
        <ion-item>
          <ion-label position='stacked'>Nivel de Nacimiento</ion-label>
          <ion-input type='number'>{{ familia.NivelNacimiento}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-label position='stacked'>Distancia al Centro Médico</ion-label>
          <ion-input type='number'>{{ familia.DistanciaCentroMedico}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-label position='stacked'>Servicios Básicos</ion-label>
          <br>
          <ion-input *ngFor='let i of familia.ServiciosVivienda' type='number'>{{ i }}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-card-header color='success'>
      <ion-toolbar color='success'>
        <ion-row>
          <ion-col>
            <ion-label>SUBTOTAL : </ion-label>
          </ion-col>
          <ion-col class="ion-text-end">
            <ion-label>{{ familia.PuntajeParcialFA }} PUNTOS</ion-label>
          </ion-col>
        </ion-row>
      </ion-toolbar>
    </ion-card-header>
  </div>

  <ion-card-header [color]='colorDiagnostico'>
    <ion-toolbar [color]='colorDiagnostico'>      
      <ion-row>
        <ion-col>
          <ion-label>PUNTAJE TOTAL</ion-label>
        </ion-col>
        <ion-col class="ion-text-end">
          <ion-label> {{ sumaTotal }} PUNTOS</ion-label>
        </ion-col>
      </ion-row>
    </ion-toolbar>
    <ion-toolbar [color]='colorDiagnostico'>
      <ion-row>
        <ion-col>
          <ion-label>DIAGNÓSTICO</ion-label>
        </ion-col>
        <ion-col class="ion-text-end">
          <ion-label> {{ diagnostico }}</ion-label>
        </ion-col>
      </ion-row>
    </ion-toolbar>
  </ion-card-header>
  <ion-card-header>
    <ion-toolbar>
      <p>Recuerda que el consolidado familiar se genera con respecto al triaje más actual(último triaje) realizado a cada miembro de la familia. </p>
    </ion-toolbar>
  </ion-card-header>

  <ion-card-header color='primary'>
    <ion-toolbar color='primary'>
      <ion-title>PLAN BÁSICO DE ACCIÓN</ion-title>
    </ion-toolbar>
  </ion-card-header>
  <ion-card-content>
    <ion-row>
      <ion-col>
        <ion-label>AISLAMIENTO DEL MIEMBRO FAMILIAR EN RIESGO
        </ion-label>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-label>CAPACITACIÓN FAMILIAR
        </ion-label>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-label>RECONOCIMIENTOS GENERALES: MASCARILLA, LAVADO DE MANOS, NO TOSER LIBREMENTE
        </ion-label>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-label>CONTROL DE TEMPERATURA
        </ion-label>
      </ion-col>
    </ion-row>

  </ion-card-content>
</ion-content>